apiVersion: apps/v1
kind: Deployment
metadata:
  name: frontend-medical-record
  labels:
    app: frontend-medical-record
spec:
  replicas: 2
  selector:
    matchLabels:
      app: frontend-medical-record
  template:
    metadata:
      labels:
        app: frontend-medical-record
    spec:
      containers:
      - name: frontend
        image: nginx:alpine
        ports:
        - containerPort: 80
          protocol: TCP
        command: ["/bin/sh"]
        args:
          - -c
          - |
            echo "<!DOCTYPE html>
            <html>
            <head>
                <title>Frontend Medical Record - DevSecOps Pipeline</title>
                <style>
                    body { font-family: Arial, sans-serif; margin: 0; padding: 40px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
                    .container { max-width: 900px; margin: 0 auto; background: rgba(255,255,255,0.95); padding: 40px; border-radius: 15px; box-shadow: 0 20px 40px rgba(0,0,0,0.1); color: #333; }
                    .header { text-align: center; margin-bottom: 30px; }
                    .header h1 { color: #2c3e50; margin: 0; font-size: 2.5em; }
                    .header h2 { color: #3498db; margin: 10px 0; }
                    .status { background: #d4edda; border-left: 5px solid #28a745; padding: 20px; margin: 20px 0; border-radius: 5px; }
                    .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin: 30px 0; }
                    .card { background: #f8f9fa; padding: 20px; border-radius: 8px; border-left: 4px solid #3498db; }
                    .btn { background: linear-gradient(45deg, #3498db, #2980b9); color: white; padding: 12px 24px; border: none; border-radius: 25px; cursor: pointer; text-decoration: none; display: inline-block; margin: 10px 5px; transition: transform 0.2s; }
                    .btn:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.2); }
                    .features { background: #e9ecef; padding: 20px; border-radius: 10px; margin: 20px 0; }
                    .feature-item { margin: 10px 0; padding: 8px; }
                    .check { color: #28a745; font-weight: bold; }
                </style>
            </head>
            <body>
                <div class='container'>
                    <div class='header'>
                        <h1>üè• Frontend Medical Record</h1>
                        <h2>DevSecOps Pipeline Activo ‚úÖ</h2>
                    </div>
                    
                    <div class='status'>
                        <h3>üöÄ Pipeline CI/CD Funcionando</h3>
                        <p><strong>Estado:</strong> Aplicaci√≥n desplegada exitosamente en Kubernetes</p>
                        <p><strong>Versi√≥n:</strong> 1.0.0</p>
                        <p><strong>Build Date:</strong> $(date)</p>
                    </div>

                    <h3 style='text-align: center; color: #2c3e50;'>üîó Accesos del Sistema</h3>
                    <div style='text-align: center;'>
                        <a href='http://192.168.49.2:30090' class='btn'>üêô ArgoCD GitOps</a>
                        <a href='http://192.168.49.2:30000' class='btn'>üìä Prometheus</a>
                        <a href='http://192.168.49.2:32000' class='btn'>üìà Grafana</a>
                    </div>

                    <div class='features'>
                        <h3>üìã Caracter√≠sticas DevSecOps Implementadas:</h3>
                        <div class='feature-item'><span class='check'>‚úÖ</span> Pipeline Jenkins CI/CD con 7 etapas automatizadas</div>
                        <div class='feature-item'><span class='check'>‚úÖ</span> An√°lisis SAST con ESLint (0 errores cr√≠ticos)</div>
                        <div class='feature-item'><span class='check'>‚úÖ</span> An√°lisis DAST con OWASP ZAP</div>
                        <div class='feature-item'><span class='check'>‚úÖ</span> GitOps con ArgoCD para despliegue continuo</div>
                        <div class='feature-item'><span class='check'>‚úÖ</span> Monitoreo con Prometheus + Grafana</div>
                        <div class='feature-item'><span class='check'>‚úÖ</span> Canary Deployment con LaunchDarkly</div>
                        <div class='feature-item'><span class='check'>‚úÖ</span> Kubernetes deployment en cluster</div>
                        <div class='feature-item'><span class='check'>‚úÖ</span> Security reports autom√°ticos</div>
                    </div>

                    <div class='grid'>
                        <div class='card'>
                            <h4>üîí Seguridad</h4>
                            <p>SAST + DAST integrado</p>
                            <p>Vulnerability scanning</p>
                        </div>
                        <div class='card'>
                            <h4>üìä Monitoreo</h4>
                            <p>Prometheus metrics</p>
                            <p>Grafana dashboards</p>
                        </div>
                        <div class='card'>
                            <h4>üöÄ Despliegue</h4>
                            <p>GitOps con ArgoCD</p>
                            <p>Canary releases</p>
                        </div>
                    </div>

                    <div style='text-align: center; margin-top: 40px; padding-top: 20px; border-top: 2px solid #ecf0f1; color: #7f8c8d;'>
                        <p><strong>Pipeline DevSecOps - Frontend Medical Record 2</strong></p>
                        <p>Implementado con ‚ù§Ô∏è usando Jenkins + ArgoCD + Kubernetes + Prometheus + Grafana</p>
                        <p>üéØ 100% Compliance con pr√°cticas DevSecOps</p>
                    </div>
                </div>
            </body>
            </html>" > /usr/share/nginx/html/index.html
            nginx -g 'daemon off;'
        resources:
          requests:
            memory: "64Mi"
            cpu: "50m"
          limits:
            memory: "128Mi" 
            cpu: "100m"
        readinessProbe:
          httpGet:
            path: /
            port: 80
          initialDelaySeconds: 5
          periodSeconds: 5
        livenessProbe:
          httpGet:
            path: /
            port: 80
          initialDelaySeconds: 10
          periodSeconds: 10